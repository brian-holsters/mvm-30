[gd_scene load_steps=23 format=3 uid="uid://rx62opg8jmrd"]

[ext_resource type="PackedScene" uid="uid://vie2pd3qfb5e" path="res://addons/bluebrains_character_controller/character_controller/2d_character_controller_base.tscn" id="1_heu0c"]
[ext_resource type="Script" uid="uid://d6b1dyqshq61" path="res://game/entities/player/mvm30_player.gd" id="2_t56eh"]
[ext_resource type="Script" uid="uid://dr0tmd1vkfnxl" path="res://game/entities/hitbox/hurt_box.gd" id="3_0rdsw"]
[ext_resource type="SpriteFrames" uid="uid://c3ixhnu256fxs" path="res://addons/bluebrains_character_controller/sprites/sprite_frames.tres" id="3_6pmmc"]
[ext_resource type="Script" uid="uid://cwdjqvddxjqqg" path="res://addons/bluebrains_character_controller/character_controller/state_machine/states/grounded.gd" id="4_0rdsw"]
[ext_resource type="Script" uid="uid://ds3cn3uu7nsr4" path="res://game/entities/player/custom_transitions/to_hurt_on_signal.gd" id="5_0rdsw"]
[ext_resource type="Script" uid="uid://ke7ebekdcqfn" path="res://addons/bluebrains_character_controller/character_controller/state_machine/input_transition.gd" id="5_xt77v"]
[ext_resource type="Script" uid="uid://cyspnbaj7tun" path="res://addons/bluebrains_character_controller/character_controller/state_machine/magic_transition.gd" id="6_conr4"]
[ext_resource type="Script" uid="uid://bdlrly1hkn1qa" path="res://addons/bluebrains_character_controller/character_controller/state_machine/dynamic_data_row.gd" id="7_4neg5"]
[ext_resource type="Script" uid="uid://dadlfrrf4y021" path="res://addons/bluebrains_character_controller/character_controller/state_machine/states/one_shot.gd" id="8_8pcyd"]
[ext_resource type="Script" uid="uid://cs6bis811k88n" path="res://addons/bluebrains_character_controller/character_controller/state_machine/states/jump_air.gd" id="9_fq5t3"]
[ext_resource type="Script" uid="uid://bnbe7mxk8wsky" path="res://addons/bluebrains_character_controller/character_controller/state_machine/states/airborne.gd" id="10_e8mlx"]
[ext_resource type="Script" uid="uid://dukw84gcuvd3d" path="res://addons/bluebrains_character_controller/character_controller/state_machine/states/hang.gd" id="11_cq8ym"]
[ext_resource type="Script" uid="uid://byfliumen4dwv" path="res://addons/bluebrains_character_controller/character_controller/state_machine/states/wall_slide.gd" id="12_1s5sw"]
[ext_resource type="Script" uid="uid://bv4kxaunywtda" path="res://game/entities/player/states/hurt_state.gd" id="13_t56eh"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_heu0c"]
size = Vector2(12, 30)

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_0rdsw"]
radius = 5.0
height = 28.0

[sub_resource type="Resource" id="Resource_yo6go"]
script = ExtResource("7_4neg5")
object = NodePath("..")
property = "get_x_velocity"
metadata/_custom_type_script = "uid://bdlrly1hkn1qa"

[sub_resource type="Resource" id="Resource_uvokq"]
script = ExtResource("7_4neg5")
object = NodePath("..")
property = "get_jump_accel_modifier"
metadata/_custom_type_script = "uid://bdlrly1hkn1qa"

[sub_resource type="Resource" id="Resource_e2h5c"]
script = ExtResource("7_4neg5")
object = NodePath("../../../LedgeDetectorR")
property = "get_snap_point"
metadata/_custom_type_script = "uid://bdlrly1hkn1qa"

[sub_resource type="Resource" id="Resource_lankm"]
script = ExtResource("7_4neg5")
object = NodePath("../../../LedgeDetectorL")
property = "get_snap_point"
metadata/_custom_type_script = "uid://bdlrly1hkn1qa"

[sub_resource type="Resource" id="Resource_onmye"]
script = ExtResource("7_4neg5")
object = NodePath("../../MovementVariables")
property = "run_speed"
metadata/_custom_type_script = "uid://bdlrly1hkn1qa"

[node name="PlayerCharacter" instance=ExtResource("1_heu0c")]
collision_layer = 2
script = ExtResource("2_t56eh")
character_size = Vector2(12, 60)

[node name="CollisionShape2D" parent="." index="0"]
position = Vector2(0, -15)
shape = SubResource("RectangleShape2D_heu0c")

[node name="AnimatedSprite2D" parent="." index="1"]
unique_name_in_owner = true
position = Vector2(0, -16)
sprite_frames = ExtResource("3_6pmmc")
animation = &"hurt_damaged"

[node name="LedgeDetectorR" parent="." index="2"]
position = Vector2(5, -29)

[node name="LedgeDetectorL" parent="." index="3"]
position = Vector2(-5, -29)

[node name="HurtBox" type="Area2D" parent="." index="4" node_paths=PackedStringArray("actor")]
script = ExtResource("3_0rdsw")
actor = NodePath("..")

[node name="CollisionShape2D" type="CollisionShape2D" parent="HurtBox" index="0"]
position = Vector2(0, -15)
shape = SubResource("CapsuleShape2D_0rdsw")
debug_color = Color(0.8163603, 0.39394102, 0.27965254, 0.41960785)

[node name="MovementVariables" parent="." index="7"]
run_speed = 100.0
time_to_run = 0.05
jump_height = 65.0
jump_time = 0.275

[node name="StateMachine" parent="." index="8" node_paths=PackedStringArray("default_state")]
default_state = NodePath("Airborne")

[node name="ToHurtOnSignal" type="Node" parent="StateMachine" index="0" node_paths=PackedStringArray("listening_node", "to_state")]
script = ExtResource("5_0rdsw")
listening_node = NodePath("../../HurtBox")
listening_signal = "hurt"
signal_arguments = 6
to_state = NodePath("../Hurt")
force_change_on_not_allowed = true
metadata/_custom_type_script = "uid://tmfwaj030o0e"

[node name="Grounded" type="Node" parent="StateMachine" index="1" node_paths=PackedStringArray("input_map", "variables", "animated_sprite")]
script = ExtResource("4_0rdsw")
input_map = NodePath("../../InputMap")
variables = NodePath("../../MovementVariables")
animated_sprite = NodePath("../../AnimatedSprite2D")
run_animation = "walk"
walk_speed_animation_magic_number = 90.0
run_speed_animation_magic_number = 90.0
metadata/_custom_type_script = "uid://b3fwraueavvlt"

[node name="ToAttack" type="Node" parent="StateMachine/Grounded" index="0" node_paths=PackedStringArray("to_state")]
script = ExtResource("5_xt77v")
input = "attack"
to_state = NodePath("../../Attack")
metadata/_custom_type_script = "uid://ke7ebekdcqfn"

[node name="ToAirborne" type="Node" parent="StateMachine/Grounded" index="1" node_paths=PackedStringArray("to_state")]
script = ExtResource("6_conr4")
auto_check = true
condition = "not is_on_floor()"
to_state = NodePath("../../Airborne")
dynamic_data = Dictionary[String, ExtResource("7_4neg5")]({
"speed_override": SubResource("Resource_yo6go")
})
metadata/_custom_type_script = "uid://cyspnbaj7tun"

[node name="ToJumpSquat" type="Node" parent="StateMachine/Grounded" index="2" node_paths=PackedStringArray("to_state")]
script = ExtResource("5_xt77v")
input = "jump"
to_state = NodePath("../../JumpSquat")
priority = 1
dynamic_data = Dictionary[String, ExtResource("7_4neg5")]({
"speed_override": SubResource("Resource_uvokq")
})
metadata/_custom_type_script = "uid://ke7ebekdcqfn"

[node name="ToDash" type="Node" parent="StateMachine/Grounded" index="3" node_paths=PackedStringArray("to_state")]
script = ExtResource("5_xt77v")
input = "run"
to_state = NodePath("../../Dash")
priority = 1
metadata/_custom_type_script = "uid://ke7ebekdcqfn"

[node name="ToTurnaroundInScript" type="Node" parent="StateMachine/Grounded" index="4"]

[node name="JumpSquat" type="Node" parent="StateMachine" index="2" node_paths=PackedStringArray("to_state", "animated_sprite")]
script = ExtResource("8_8pcyd")
to_state = NodePath("../JumpAir")
animated_sprite = NodePath("../../AnimatedSprite2D")
animation_name = "land"
time_shortcut = true
time = 0.05
metadata/_custom_type_script = "uid://dadlfrrf4y021"

[node name="JumpAir" type="Node" parent="StateMachine" index="3" node_paths=PackedStringArray("input_map", "variables", "landing_state", "airborne_state", "animated_sprite")]
script = ExtResource("9_fq5t3")
input_map = NodePath("../../InputMap")
variables = NodePath("../../MovementVariables")
landing_state = NodePath("../Grounded")
airborne_state = NodePath("../Airborne")
animated_sprite = NodePath("../../AnimatedSprite2D")
metadata/_custom_type_script = "uid://b3fwraueavvlt"

[node name="ToDash" type="Node" parent="StateMachine/JumpAir" index="0" node_paths=PackedStringArray("to_state")]
script = ExtResource("5_xt77v")
input = "run"
to_state = NodePath("../../Dash")
priority = 1
metadata/_custom_type_script = "uid://ke7ebekdcqfn"

[node name="Airborne" type="Node" parent="StateMachine" index="4" node_paths=PackedStringArray("input_map", "variables", "landing_state", "animated_sprite")]
script = ExtResource("10_e8mlx")
input_map = NodePath("../../InputMap")
variables = NodePath("../../MovementVariables")
landing_state = NodePath("../Grounded")
animated_sprite = NodePath("../../AnimatedSprite2D")
metadata/_custom_type_script = "uid://b3fwraueavvlt"

[node name="ToHangR" type="Node" parent="StateMachine/Airborne" index="0" node_paths=PackedStringArray("to_state")]
script = ExtResource("6_conr4")
auto_check = true
condition = "ledge_detector_r.has_snap_point() and not looking_left and velocity.y > 0"
to_state = NodePath("../../Hang")
priority = 2
dynamic_data = Dictionary[String, ExtResource("7_4neg5")]({
"snap_point": SubResource("Resource_e2h5c")
})
metadata/_custom_type_script = "uid://cyspnbaj7tun"

[node name="ToHangL" type="Node" parent="StateMachine/Airborne" index="1" node_paths=PackedStringArray("to_state")]
script = ExtResource("6_conr4")
auto_check = true
condition = "ledge_detector_l.has_snap_point() and looking_left and velocity.y > 0"
to_state = NodePath("../../Hang")
priority = 2
dynamic_data = Dictionary[String, ExtResource("7_4neg5")]({
"snap_point": SubResource("Resource_lankm")
})
metadata/_custom_type_script = "uid://cyspnbaj7tun"

[node name="ToWallSlideR" type="Node" parent="StateMachine/Airborne" index="2" node_paths=PackedStringArray("to_state")]
script = ExtResource("6_conr4")
auto_check = true
condition = "is_on_wall_only() and get_wall_normal().x < 0 and not looking_left"
to_state = NodePath("../../WallSlide")
priority = 1
metadata/_custom_type_script = "uid://cyspnbaj7tun"

[node name="ToWallSlideL" type="Node" parent="StateMachine/Airborne" index="3" node_paths=PackedStringArray("to_state")]
script = ExtResource("6_conr4")
auto_check = true
condition = "is_on_wall_only() and get_wall_normal().x > 0 and looking_left"
to_state = NodePath("../../WallSlide")
priority = 1
metadata/_custom_type_script = "uid://cyspnbaj7tun"

[node name="ToDash" type="Node" parent="StateMachine/Airborne" index="4" node_paths=PackedStringArray("to_state")]
script = ExtResource("5_xt77v")
input = "run"
condition = "state_machine.behaviour_variables.can_airdash()"
to_state = NodePath("../../Dash")
priority = 1
metadata/_custom_type_script = "uid://ke7ebekdcqfn"

[node name="Attack" type="Node" parent="StateMachine" index="5" node_paths=PackedStringArray("to_state", "animated_sprite")]
script = ExtResource("8_8pcyd")
to_state = NodePath("../Grounded")
animated_sprite = NodePath("../../AnimatedSprite2D")
animation_name = "punch_jab"
override_x_movement = true
x_movement_delta = 10.0
is_available = false
metadata/_custom_type_script = "uid://dadlfrrf4y021"

[node name="TurnAround" type="Node" parent="StateMachine" index="6" node_paths=PackedStringArray("to_state", "animated_sprite")]
script = ExtResource("8_8pcyd")
to_state = NodePath("../Grounded")
animated_sprite = NodePath("../../AnimatedSprite2D")
animation_name = "slide"
time_shortcut = true
time = 0.1
override_x_movement = true
x_movement_delta = 10.0
metadata/_custom_type_script = "uid://dadlfrrf4y021"

[node name="Hang" type="Node" parent="StateMachine" index="7" node_paths=PackedStringArray("animated_sprite")]
script = ExtResource("11_cq8ym")
animated_sprite = NodePath("../../AnimatedSprite2D")
animation_name = "ledge_grab_climb"
metadata/_custom_type_script = "uid://b3fwraueavvlt"

[node name="ToAirborneOnDown" type="Node" parent="StateMachine/Hang" index="0" node_paths=PackedStringArray("to_state")]
script = ExtResource("5_xt77v")
input = "down"
to_state = NodePath("../../Airborne")
metadata/_custom_type_script = "uid://ke7ebekdcqfn"

[node name="ToJumpAir" type="Node" parent="StateMachine/Hang" index="1" node_paths=PackedStringArray("to_state")]
script = ExtResource("5_xt77v")
input = "jump"
to_state = NodePath("../../JumpAir")
metadata/_custom_type_script = "uid://ke7ebekdcqfn"

[node name="WallSlide" type="Node" parent="StateMachine" index="8" node_paths=PackedStringArray("input_map", "variables", "animated_sprite")]
script = ExtResource("12_1s5sw")
input_map = NodePath("../../InputMap")
variables = NodePath("../../MovementVariables")
animated_sprite = NodePath("../../AnimatedSprite2D")
is_available = false
metadata/_custom_type_script = "uid://b3fwraueavvlt"

[node name="ToGrounded" type="Node" parent="StateMachine/WallSlide" index="0" node_paths=PackedStringArray("to_state")]
script = ExtResource("6_conr4")
auto_check = true
condition = "is_on_floor()"
to_state = NodePath("../../Grounded")
metadata/_custom_type_script = "uid://cyspnbaj7tun"

[node name="ToHangR" type="Node" parent="StateMachine/WallSlide" index="1" node_paths=PackedStringArray("to_state")]
script = ExtResource("6_conr4")
auto_check = true
condition = "ledge_detector_r.has_snap_point() and not looking_left and velocity.y > 0"
to_state = NodePath("../../Hang")
priority = 1
dynamic_data = Dictionary[String, ExtResource("7_4neg5")]({
"snap_point": SubResource("Resource_e2h5c")
})
metadata/_custom_type_script = "uid://cyspnbaj7tun"

[node name="ToHangL" type="Node" parent="StateMachine/WallSlide" index="2" node_paths=PackedStringArray("to_state")]
script = ExtResource("6_conr4")
auto_check = true
condition = "ledge_detector_l.has_snap_point() and looking_left and velocity.y > 0"
to_state = NodePath("../../Hang")
priority = 1
dynamic_data = Dictionary[String, ExtResource("7_4neg5")]({
"snap_point": SubResource("Resource_lankm")
})
metadata/_custom_type_script = "uid://cyspnbaj7tun"

[node name="ToAirborne" type="Node" parent="StateMachine/WallSlide" index="3" node_paths=PackedStringArray("to_state")]
script = ExtResource("6_conr4")
auto_check = true
condition = "not is_on_wall()"
to_state = NodePath("../../Airborne")
priority = 1
metadata/_custom_type_script = "uid://cyspnbaj7tun"

[node name="ToWallJump" type="Node" parent="StateMachine/WallSlide" index="4" node_paths=PackedStringArray("to_state")]
script = ExtResource("5_xt77v")
input = "jump"
to_state = NodePath("../../WallJump")
metadata/_custom_type_script = "uid://ke7ebekdcqfn"

[node name="ToDash" type="Node" parent="StateMachine/WallSlide" index="5" node_paths=PackedStringArray("to_state")]
script = ExtResource("5_xt77v")
input = "run"
to_state = NodePath("../../Dash")
priority = 1
data = Dictionary[String, Variant]({
"_turnaround_on_enter": true
})
metadata/_custom_type_script = "uid://ke7ebekdcqfn"

[node name="WallJump" type="Node" parent="StateMachine" index="9" node_paths=PackedStringArray("input_map", "variables", "landing_state", "airborne_state", "animated_sprite")]
script = ExtResource("9_fq5t3")
input_map = NodePath("../../InputMap")
variables = NodePath("../../MovementVariables")
landing_state = NodePath("../Grounded")
airborne_state = NodePath("../Airborne")
animated_sprite = NodePath("../../AnimatedSprite2D")
override_x_velocity = true
multiply_velocity_looking_left = true
x_velocity = 150.0
ignore_input_time = 0.5
turnaround_on_enter = true
metadata/_custom_type_script = "uid://b3fwraueavvlt"

[node name="ToDash" type="Node" parent="StateMachine/WallJump" index="0" node_paths=PackedStringArray("to_state")]
script = ExtResource("5_xt77v")
input = "run"
to_state = NodePath("../../Dash")
metadata/_custom_type_script = "uid://ke7ebekdcqfn"

[node name="Dash" type="Node" parent="StateMachine" index="10" node_paths=PackedStringArray("to_state", "animated_sprite")]
script = ExtResource("8_8pcyd")
to_state = NodePath("../Airborne")
animated_sprite = NodePath("../../AnimatedSprite2D")
animation_name = "dash"
time_shortcut = true
time = 0.2
override_x_movement = true
multiply_x_by_looking_left = true
x_movement_value = 300.0
x_movement_delta = 9999.0
override_y_movement = true
y_movement_delta = 100.0
dynamic_data = Dictionary[String, ExtResource("7_4neg5")]({
"speed_override": SubResource("Resource_onmye")
})
is_available = false
metadata/_custom_type_script = "uid://dadlfrrf4y021"

[node name="ToWallSlideR" type="Node" parent="StateMachine/Dash" index="0" node_paths=PackedStringArray("to_state")]
script = ExtResource("6_conr4")
auto_check = true
condition = "is_on_wall_only() and get_wall_normal().x < 0 and not looking_left"
to_state = NodePath("../../WallSlide")
priority = 1
metadata/_custom_type_script = "uid://cyspnbaj7tun"

[node name="ToWallSlideL" type="Node" parent="StateMachine/Dash" index="1" node_paths=PackedStringArray("to_state")]
script = ExtResource("6_conr4")
auto_check = true
condition = "is_on_wall_only() and get_wall_normal().x > 0 and looking_left"
to_state = NodePath("../../WallSlide")
priority = 1
metadata/_custom_type_script = "uid://cyspnbaj7tun"

[node name="ToJumpSquat" type="Node" parent="StateMachine/Dash" index="2" node_paths=PackedStringArray("to_state")]
script = ExtResource("5_xt77v")
input = "jump"
condition = "is_on_floor()"
to_state = NodePath("../../JumpSquat")
data = Dictionary[String, Variant]({
"speed_override": 400.0
})
metadata/_custom_type_script = "uid://ke7ebekdcqfn"

[node name="Hurt" type="Node" parent="StateMachine" index="11" node_paths=PackedStringArray("variables", "grounded_state", "airborne_state", "animated_sprite_2d")]
script = ExtResource("13_t56eh")
variables = NodePath("../../MovementVariables")
grounded_state = NodePath("../Grounded")
airborne_state = NodePath("../Airborne")
animated_sprite_2d = NodePath("../../AnimatedSprite2D")
animation = "hurt_damaged"
default_knockback = Vector2(100, -300)
default_stun_time = 0.2
metadata/_custom_type_script = "uid://b3fwraueavvlt"

[connection signal="state_changed" from="StateMachine" to="BehaviourVariables" method="_on_state_machine_state_changed"]
